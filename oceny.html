<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>P-Librus - Oceny</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f0f4f8;
      margin: 0;
      padding: 0;
    }
    .header, .menu {
      background: #ffffff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 30px;
    }
    .logo {
      display: flex;
      align-items: center;
    }
    .logo img {
      height: 40px;
      margin-right: 10px;
    }
    .logo span {
      font-size: 26px;
      color: #6a1b9a;
      font-weight: 700;
    }
    .user-info {
      font-size: 14px;
    }
    .menu {
      display: flex;
      justify-content: center;
      padding: 15px 0;
      gap: 15px;
      flex-wrap: wrap;
    }
    .menu-item a {
      font-size: 14px;
      padding: 10px 18px;
      border-radius: 8px;
      text-decoration: none;
      background: #e0e0e0;
      color: #333;
      transition: 0.3s;
    }
    .menu-item a:hover {
      background: #c5c5c5;
    }
    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: crimson;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 50%;
    }
    .container {
      padding: 30px;
    }
    h2 {
      color: #444;
    }
    select, textarea, button {
      margin: 10px 0;
      padding: 8px;
      font-size: 14px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      background: #6a6a6a;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background: #4a4a4a;
    }
    .students {
      margin-top: 20px;
    }
    .student {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }
    .student span {
      width: 150px;
      font-weight: 500;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }
    th, td {
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #e0e0e0;
      color: #333;
    }
    .tabela-klasy {
      margin-bottom: 60px;
    }
    .grade {
      position: relative;
      display: inline-block;
      margin: 0 3px;
    }
    .grade .tooltip {
      visibility: hidden;
      width: 200px;
      background-color: #333;
      color: #fff;
      text-align: left;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      margin-left: -100px;
      opacity: 0;
      transition: opacity 0.3s;
    }
    .grade:hover .tooltip {
      visibility: visible;
      opacity: 1;
    
 
}
/* Kolorowanie według typu oceny */
.typ-Sprawdzian       { background-color: #ffccbc; color: black; }
.typ-Pracaklasowa     { background-color: #ffe0b2; color: black; }
.typ-Kartkówka        { background-color: #fff59d; color: black; }
.typ-Projekt          { background-color: #b3e5fc; color: black; }
.typ-Prezentacja      { background-color: #d1c4e9; color: black; }
.typ-Pracanalekcji    { background-color: #dcedc8; color: black; }
.typ-Odpowiedźustna   { background-color: #f8bbd0; color: black; }
.typ-Zadanie          { background-color: #c8e6c9; color: black; }
.typ-Inne             { background-color: #90caf9; color: black; }
.typ-Przewidywana     { background-color: #cfd8dc; color: black; }
.typ-Roczna           { background-color: #b0bec5; color: black; }
.typ-Poprawa          { background-color: #ffab91; color: black; }
.typ-Aktywność        { background-color: #f0f4c3; color: black; }
.typ-Pracadomowa      { background-color: #e6ee9c; color: black; }
.typ-Półroczna        { background-color: #e0f7fa; color: black; }


}

  </style>
</head>
<body>

<script type="module">
  // Importy z Firebase CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    // twoja konfiguracja
  };// Your web app's Firebase configuration (wklej tutaj swój config)
  const firebaseConfig = {
  apiKey: "AIzaSyDlSm_Cg8Pz0rPsExKro958vjRDUD_i95Y",
  authDomain: "p-librus.firebaseapp.com",
  projectId: "p-librus",
  storageBucket: "p-librus.firebasestorage.app",
  messagingSenderId: "1018564561209",
  appId: "1:1018564561209:web:14fc2df790ca838837c0e8"
};

 

  // teraz możesz używać db, np. dodawanie i pobieranie dokumentów
</script>

  

  // Initialize Firebase
  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>
  <div class="header">
    <div class="logo">
      <img src="21 maj 2025, 16_13_32.png" alt="P-Librus logo">
      <span>P-Librus</span>
    </div>
    <div class="user-info">
      Zalogowany jako: <strong>Piotr Rejmentowski (nauczyciel)</strong>
    </div>
    <select>
      <option selected>polski</option>
      <option>english</option>
    </select>
  </div>

  <div class="menu">
    <div class="menu-item"><a href="indywidualni.html">Indywidualni</a></div>
    <div class="menu-item"><a href="Lekcja.html">Lekcja</a></div>
    <div class="menu-item"><a href="oceny.html">Oceny</a><div class="badge">5</div></div>
    <div class="menu-item"><a href="organizacja.html">Organizacja</a><div class="badge">3</div></div>
    <div class="menu-item"><a href="wiadomosci.html">Wiadomości</a></div>
    <div class="menu-item"><a href="ogloszenia.html">Ogłoszenia</a><div class="badge">1</div></div>
    <div class="menu-item"><a href="terminarz.html">Terminarz</a><div class="badge">6</div></div>
  </div>

  <div class="container">
    <h2>Dodaj ocenę</h2>
    <label for="klasa">Klasa:</label>
    <select id="klasa" onchange="pokazUczniow(); pokazTabele();"></select>
    <label for="typ">Typ oceny:</label>
    <select id="typ">
      <option>Sprawdzian</option>
      <option>Praca klasowa</option>
      <option>Kartkówka</option>
      <option>Projekt</option>
      <option>Prezentacja</option>
      <option>Praca na lekcji</option>
      <option>Odpowiedź ustna</option>
      <option>Zadanie</option>
      <option>Inne</option>
      <option>Przewidywana</option>
      <option>Roczna</option>
      <option>Poprawa</option>
	  <option>Aktywność</option>
	  <option>Praca domowa</option>
	  <option>Aktywność</option>
	  <option>Półroczna</option>
    </select>
    <label for="komentarz">Komentarz:</label>
    <textarea id="komentarz" rows="2" cols="50"></textarea>
    <div class="students" id="students"></div>
    <button onclick="zapiszOceny()">Zapisz ocenę</button>
	<br>
	<label for="sortowanie">Sortuj oceny według:</label>
<select id="sortowanie" onchange="pokazTabele()">
  <option value="domyślnie">Domyślnie</option>
  <option value="data">Data</option>
  <option value="typ">Kategoria</option>
  <option value="ocena">Wartość oceny</option>
</select>

    <h2>Tabela ocen dla klasy</h2>
    <div id="tabeleKlas"></div>
  </div>

  <!-- [Twój kod aż do <script>] -->

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const klasy = {
      '6A': ['Agata', 'Tadeusz', 'Piotr'],
      '6B': ['Gosia', 'Grzesiek', 'Agnieszka', 'Adam'],
      '6C': ['Wiesia', 'Alina', 'Bożena', 'Halinka'],
      '7D': ['Mirek', 'Ela', 'Ula'],
      '7E': ['Ola', 'Maria', 'Marta'],
      '8F': ['Ola', 'Julia', 'Natan', 'Filip'],
      '8G': ['Jagoda', 'Szymon', 'Antek', 'Lena'],
      '1H': ['Andrzej', 'Maciej', 'Patryk'],
	'6A-Biologia': ['Agata', 'Tadeusz', 'Piotr'],
	'4I-Przyroda': ['Zuzia', 'Kasia', 'Maja']
    };

    const ocenyMozliwe = ['BZ', 'NP', '-', '+', '1', '1+','2-','2','2+','3-', '3','3+', '4-', '4','4+', '5-','5', '5+', '6-','6'];
    const selectKlasa = document.getElementById('klasa');
    const studentsDiv = document.getElementById('students');
    const tabeleKlasDiv = document.getElementById('tabeleKlas');

    for (let klasa in klasy) {
      const option = document.createElement('option');
      option.value = klasa;
      option.textContent = klasa;
      selectKlasa.appendChild(option);
    }

    function pokazUczniow() {
      studentsDiv.innerHTML = '';
      const wybranaKlasa = selectKlasa.value;
      klasy[wybranaKlasa].forEach(uczen => {
        const div = document.createElement('div');
        div.className = 'student';
        div.innerHTML = `<span>${uczen}</span>
          <select id="ocena-${uczen}">
            <option value="">-</option>
            ${ocenyMozliwe.map(o => `<option value="${o}">${o}</option>`).join('')}
          </select>`;
        studentsDiv.appendChild(div);
      });
    }

    function zapiszOceny() {
      const typ = document.getElementById('typ').value;
      const komentarz = document.getElementById('komentarz').value;
      const klasa = selectKlasa.value;
      if (!klasa) return alert('Wybierz klasę');

      const oceny = klasy[klasa].map(uczen => {
        const select = document.getElementById(`ocena-${uczen}`);
        return {
          uczen,
          ocena: select.value,
          typ,
          komentarz,
          data: new Date().toLocaleDateString()
        };
      });

      const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
      if (!zapisane[klasa]) zapisane[klasa] = [];
      zapisane[klasa].push(...oceny.filter(o => o.ocena !== ''));
      localStorage.setItem('oceny', JSON.stringify(zapisane));
      pokazUczniow();
      pokazTabele();
      alert('Oceny zapisane!');
    }

    function edytujOcene(klasa, uczen, index) {
      const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
      const ocenyUcznia = zapisane[klasa].filter(o => o.uczen === uczen);
	  const sortuj = document.getElementById('sortowanie')?.value || 'domyślnie';

if (sortuj === 'data') {
  // sortowanie od najnowszej do najstarszej
  ocenyUcznia.sort((a, b) => new Date(b.data) - new Date(a.data));
} else if (sortuj === 'typ') {
  // sortowanie alfabetyczne wg typu (kategorii)
  ocenyUcznia.sort((a, b) => a.typ.localeCompare(b.typ));
} else if (sortuj === 'ocena') {
  // sortowanie malejąco po wartości liczbowej
  const getVal = x => isNaN(parseInt(x.ocena)) ? 0 : parseInt(x.ocena);
  ocenyUcznia.sort((a, b) => getVal(b) - getVal(a));
}


      const ocenaDoEdycji = ocenyUcznia[index];
      if (!ocenaDoEdycji) return;

      const nowaOcena = prompt('Nowa ocena:', ocenaDoEdycji.ocena);
      if (nowaOcena === null) return;

      const nowyTyp = prompt('Nowy typ oceny:', ocenaDoEdycji.typ);
      if (nowyTyp === null) return;

      const nowyKomentarz = prompt('Nowy komentarz:', ocenaDoEdycji.komentarz || '');
      if (nowyKomentarz === null) return;

      ocenaDoEdycji.ocena = nowaOcena;
      ocenaDoEdycji.typ = nowyTyp;
      ocenaDoEdycji.komentarz = nowyKomentarz;

      localStorage.setItem('oceny', JSON.stringify(zapisane));
      pokazTabele();
      alert('Ocena zaktualizowana.');
    }

    function pokazTabele() {
  const zapisane = JSON.parse(localStorage.getItem('oceny') || '{}');
  const wybranaKlasa = selectKlasa.value;
  tabeleKlasDiv.innerHTML = '';

  if (!zapisane[wybranaKlasa]) return;

  const table = document.createElement('table');
  table.classList.add('tabela-klasy');

  let html = `<thead><tr>
    <th>Uczeń</th>
    <th>Oceny</th>
    <th>Średnia</th>
    <th>Półroczna</th>
    <th>Przewidywana</th>
    <th>Roczna</th>
  </tr></thead><tbody>`;

  klasy[wybranaKlasa].forEach(uczen => {
    let ocenyUcznia = zapisane[wybranaKlasa].filter(o => o.uczen === uczen);

    // 🔽 SORTOWANIE 🔽
    const sortuj = document.getElementById('sortowanie')?.value || 'domyślnie';
    if (sortuj === 'data') {
      ocenyUcznia.sort((a, b) => new Date(b.data.split('.').reverse().join('-')) - new Date(a.data.split('.').reverse().join('-')));
    } else if (sortuj === 'typ') {
      ocenyUcznia.sort((a, b) => a.typ.localeCompare(b.typ));
    } else if (sortuj === 'ocena') {
      const getVal = x => isNaN(parseInt(x.ocena)) ? 0 : parseInt(x.ocena);
      ocenyUcznia.sort((a, b) => getVal(b) - getVal(a));
    }

    const polroczna = ocenyUcznia.find(o => o.typ === 'Półroczna')?.ocena || '';
    const przewidywana = ocenyUcznia.find(o => o.typ === 'Przewidywana')?.ocena || '';
    const roczna = ocenyUcznia.find(o => o.typ === 'Roczna')?.ocena || '';

    const liczby = ocenyUcznia
      .filter(o => !isNaN(parseInt(o.ocena)) && !['Przewidywana', 'Roczna', 'Półroczna'].includes(o.typ))
      .map(o => parseInt(o.ocena));
    const srednia = liczby.length ? (liczby.reduce((a, b) => a + b, 0) / liczby.length).toFixed(2) : '';

    const ocenyHTML = ocenyUcznia.map((o, idx) => {
      const klasaTypu = `typ-${o.typ.replace(/\s/g, '')}`;
      return `
        <span class="grade ${klasaTypu}" style="cursor:pointer;" onclick="edytujOcene('${wybranaKlasa}', '${uczen}', ${idx})">
          ${o.ocena}${o.typ.toLowerCase() === 'poprawa' ? '*' : ''}
          <div class="tooltip">${o.typ}\n${o.komentarz}\n${o.data}</div>
        </span>`;
    }).join(' ');

    html += `<tr>
      <td>${uczen}</td>
      <td>${ocenyHTML}</td>
      <td>${srednia}</td>
      <td>${polroczna}</td>
      <td>${przewidywana}</td>
      <td>${roczna}</td>
    </tr>`;
  });

  html += '</tbody>';
  table.innerHTML = `<caption><strong>Klasa ${wybranaKlasa}</strong></caption>` + html;
  tabeleKlasDiv.appendChild(table);
}


    selectKlasa.selectedIndex = 0;
    pokazUczniow();
    pokazTabele();

    window.pokazUczniow = pokazUczniow;
    window.pokazTabele = pokazTabele;
    window.zapiszOceny = zapiszOceny;
    window.edytujOcene = edytujOcene;
  });
</script>

  <!-- Firebase App (core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>

</body>
</html>
