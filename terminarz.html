<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<title>Terminarz z wydarzeniami</title>
<style>
body {
      font-family: Arial, sans-serif;
      background: linear-gradient(to right, #e6ebed, #f5f7f9);
      margin: 0;
      padding: 0;
    }
    .header {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background: linear-gradient(to right, #d4dce4, #f2f3f5);
    }
    .logo {
      display: flex;
      align-items: center;
      margin-right: auto;
    }
    .logo img {
      height: 40px;
      margin-right: 10px;
    }
    .logo span {
      font-size: 24px;
      color: #8a2e6e;
      font-weight: bold;
    }
    .user-info {
      margin-right: 20px;
      font-size: 14px;
    }
    .menu {
      display: flex;
      justify-content: center;
      padding: 10px;
      background-color: #edf0f3;
      flex-wrap: wrap;
    }
    .menu-item {
      text-align: center;
      margin: 10px;
      position: relative;
    }
    .menu-item a {
      font-size: 14px;
      display: block;
      padding: 10px 15px;
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
      text-decoration: none;
      color: black;
      transition: background-color 0.3s;
    }
    .menu-item a:hover {
      background-color: #f0f0f0;
    }
    .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background-color: red;
      color: white;
      font-size: 10px;
      padding: 2px 5px;
      border-radius: 50%;
    }
  body {
    font-family: Arial, sans-serif;
    background: #f0f0f5;
    margin: 0; padding: 0;
  }
  .form {
    max-width: 900px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 10px #ccc;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
  }
  .form label {
    display: flex;
    flex-direction: column;
    font-size: 14px;
    min-width: 150px;
  }
  .form input, .form select, .form button {
    padding: 6px 8px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
  .calendar {
    max-width: 900px;
    margin: 20px auto;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 0 10px #ccc;
  }
  .calendar-grid {
    display: grid;
    grid-template-columns: 70px repeat(7, 1fr);
    gap: 5px;
    text-align: center;
  }
  .day.header {
    font-weight: bold;
    background: #e0e0e0;
    padding: 10px 0;
    border-radius: 6px;
  }
  .day {
    background: #fafafa;
    min-height: 100px;
    border-radius: 6px;
    position: relative;
    padding: 5px;
    overflow-y: auto;
  }
  .week-number {
    background: #ddd;
    font-weight: bold;
    padding: 10px 0;
    border-radius: 6px;
  }
  .date-number {
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 14px;
    font-weight: bold;
    color: #555;
  }
  .event {
    margin-top: 4px;
    padding: 3px 6px;
    border-radius: 4px;
    font-size: 12px;
    color: white;
    text-align: left;
  }
  .Sprawdzian { background-color: #ff00a8; }
  .Praca-Klasowa { background-color: #ff1e1e; }
  .Projekt { background-color: #FFA500; }
  .Dzien-Wolny{ background-color: #d8ca93; }
  .Kartkowka { background-color: #8a2be2; }
  .Inne { background-color: #daa520; }
  .Nieobecnosc-nauczyciela { background-color: #ff7c7c; }
  .Zastepstwo { background-color: #709404; }
  .Odwolano { background-color: #709404; }
</style>
</head>
<body>
<script type="module">
  // Importy z Firebase CDN
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    // twoja konfiguracja
  };// Your web app's Firebase configuration (wklej tutaj swój config)
  const firebaseConfig = {
  apiKey: "AIzaSyDlSm_Cg8Pz0rPsExKro958vjRDUD_i95Y",
  authDomain: "p-librus.firebaseapp.com",
  projectId: "p-librus",
  storageBucket: "p-librus.firebasestorage.app",
  messagingSenderId: "1018564561209",
  appId: "1:1018564561209:web:14fc2df790ca838837c0e8"
};

 

  // teraz możesz używać db, np. dodawanie i pobieranie dokumentów
</script>
<div class="header">
  <div class="logo">
    <img src="21 maj 2025, 16_13_32.png" alt="P-Librus logo">
    <span>P-Librus</span>
  </div>
  <div class="user-info">
    Jesteś zalogowany jako: <strong>Piotr Rejmentowski (nauczyciel)</strong>
  </div>
  <select>
    <option selected>polski</option>
    <option>english</option>
  </select>
</div>

<div class="menu">
  <div class="menu-item">
    <a href="indywidualni.html">Indywidualni</a>
	<div class="badge">Nie aktywne</div>
  </div>
  <div class="menu-item">
    <a href="Lekcja.html">Lekcja</a>
  </div>
  <div class="menu-item">
    <a href="oceny.html">Oceny</a>
    <div class="badge">5</div>
  </div>
  <div class="menu-item">
    <a href="organizacja.html">Organizacja</a>
    <div class="badge">3</div>
  </div>
  <div class="menu-item">
    <a href="wiadomosci.html">Wiadomości</a>
  </div>
  <div class="menu-item">
    <a href="ogloszenia.html">Ogłoszenia</a>
    <div class="badge">1</div>
  </div>
  <div class="menu-item">
    <a href="terminarz.html">Terminarz</a>
    <div class="badge">6</div>
  </div>
<div class="form">
  <label>
    Miesiąc:
    <select id="month"></select>
  </label>
  <label>
    Rok:
    <select id="year"></select>
  </label>
  <label>
    Przedmiot:
    <select id="subject">
      <option>Język piotrowski</option>
      <option>Biologia</option>
	  <option>Przyroda</option>
	  <option>Język obcy</option>
	  <option>Inne</option>
	  <option>Szkoła</option>
    </select>
  </label>
  <label>
    Typ wydarzenia:
    <select id="type">
      <option value="Sprawdzian">Sprawdzian</option>
      <option value="Praca-Klasowa">Praca klasowa</option>
      <option value="Projekt">Projekt</option>
      <option value="Dzien-Wolny">Dzień wolny</option>
      <option value="Kartkowka">Kartkówka</option>
      <option value="Inne">Inne</option>
	  <option value="Nieobecnosc-nauczyciela">Nieobecnosć nauczyciela</option>
	  <option value="Zastepstwo">Zastępstwo</option>
	  <option value="Odwolano">Odwołano lekcje</option>
    </select>
  </label>
  <label>
    Data:
    <input type="date" id="date">
  </label>
  <label>
    Komentarz:
    <input type="text" id="comment" placeholder="Opcjonalny komentarz" style="width: 180px;">
  </label>
  <label>
    Klasa:
    <select id="class">
  	  <option value="4I">4I</option>
      <option value="6A">6A</option>
      <option value="6B">6B</option>
      <option value="6C">6C</option>
      <option value="7D">7D</option>
      <option value="7E">7E</option>
      <option value="8F">8F</option>
      <option value="8G">8G</option>
      <option value="1H">1H</option>
	  <option value="Klasy-8">Klasy 8</option>
	  <option value="Klasy-7">Klasy 7</option>
	  <option value="Klasy-6">Klasy 6</option>
	  <option value="Klasy-bjp">Klasy bez języka piotrowkskiego</option>
	  <option value="Szkola">Szkoła</option>
    </select>
  </label>
  <button onclick="addEvent()">Dodaj wydarzenie</button>
</div>

<div class="calendar">
  <h2 id="calendar-title"></h2>
  <div id="calendar-grid" class="calendar-grid"></div>
</div>

<script>
  const monthNames = ['Styczeń', 'Luty', 'Marzec', 'Kwiecień', 'Maj', 'Czerwiec', 'Lipiec', 'Sierpień', 'Wrzesień', 'Październik', 'Listopad', 'Grudzień'];
  const dayNames = ['Pn', 'Wt', 'Śr', 'Cz', 'Pt', 'So', 'Nd'];

  const monthSelect = document.getElementById('month');
  const yearSelect = document.getElementById('year');
  const dateInput = document.getElementById('date');

  // Wypełniamy selecty miesiąc i rok
  for(let i = 0; i < 12; i++) {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = monthNames[i];
    monthSelect.appendChild(opt);
  }
  for(let y = 2024; y <= 2026; y++) {
    const opt = document.createElement('option');
    opt.value = y;
    opt.textContent = y;
    yearSelect.appendChild(opt);
  }

  // Domyślne wartości
  const today = new Date();
  monthSelect.value = today.getMonth();
  yearSelect.value = today.getFullYear();
  dateInput.valueAsDate = today;

  monthSelect.addEventListener('change', () => generateCalendar(+monthSelect.value, +yearSelect.value));
  yearSelect.addEventListener('change', () => generateCalendar(+monthSelect.value, +yearSelect.value));

  // Funkcja numeru tygodnia wg ISO
  function getWeekNumber(date) {
  const target = new Date(date.valueOf());
  const dayNr = (date.getDay() + 6) % 7;  // Poniedziałek = 0, niedziela = 6
  target.setDate(target.getDate() - dayNr + 3);  // Ustawiamy na czwartek tego tygodnia
  const firstThursday = new Date(target.getFullYear(), 0, 4); // 4 stycznia
  const diff = target - firstThursday;
  return 1 + Math.round(diff / 604800000); // 604800000 = ms w tygodniu
}

  // Pobierz wydarzenia z localStorage
  function getEvents() {
    return JSON.parse(localStorage.getItem('events') || '[]');
  }

  // Zapisz wydarzenia do localStorage
  function saveEvents(events) {
    localStorage.setItem('events', JSON.stringify(events));
  }

  // Dodaj wydarzenie
  function addEvent() {
    const subject = document.getElementById('subject').value;
    const type = document.getElementById('type').value;
    const date = document.getElementById('date').value;
    const comment = document.getElementById('comment').value.trim();
    const className = document.getElementById('class').value;

    if (!date) {
      alert("Wybierz datę przed dodaniem wydarzenia.");
      return;
    }

    const events = getEvents();
    events.push({ subject, type, date, comment, className });
    saveEvents(events);

    generateCalendar(+monthSelect.value, +yearSelect.value);

    // Wyczyść komentarz po dodaniu
    document.getElementById('comment').value = '';
  }

  // Generowanie kalendarza
  function generateCalendar(month, year) {
    const calendarGrid = document.getElementById('calendar-grid');
    const calendarTitle = document.getElementById('calendar-title');
    calendarTitle.textContent = `${monthNames[month]} ${year}`;
    calendarGrid.innerHTML = '';

    // Nagłówki kolumn
    calendarGrid.appendChild(createCell('Tydzień', true, 'week-number'));
    dayNames.forEach(day => {
      calendarGrid.appendChild(createCell(day, true, 'day header'));
    });

    // Pierwszy dzień miesiąca i jego przesunięcie (poniedziałek = 0)
    const firstOfMonth = new Date(year, month, 1);
    const firstDayWeekDay = (firstOfMonth.getDay() + 6) % 7;
    const calendarStart = new Date(year, month, 1 - firstDayWeekDay);

    // Pobierz wydarzenia
    const events = getEvents();

    for(let week = 0; week < 6; week++) {
      const weekStartDate = new Date(calendarStart);
      weekStartDate.setDate(calendarStart.getDate() + week * 7);

      // Numer tygodnia
      calendarGrid.appendChild(createCell(getWeekNumber(weekStartDate), false, 'week-number'));

      for(let day = 0; day < 7; day++) {
        const currentDate = new Date(weekStartDate);
        currentDate.setDate(weekStartDate.getDate() + day);

        const cell = createCell('', false, 'day');
        const isCurrentMonth = currentDate.getMonth() === month;

        if(isCurrentMonth) {
          cell.innerHTML = `<div class="date-number">${currentDate.getDate()}</div>`;

          // Znajdź wydarzenia na ten dzień i wstaw je
          const dayStr = currentDate.toISOString().slice(0,10);
          const todaysEvents = events.filter(ev => ev.date === dayStr);

          todaysEvents.forEach((ev, idx) => {
  const globalIndex = events.findIndex(e =>
    e.subject === ev.subject &&
    e.type === ev.type &&
    e.date === ev.date &&
    e.comment === ev.comment &&
    e.className === ev.className
  );

  const evDiv = document.createElement('div');
  evDiv.className = `event ${ev.type}`;
  evDiv.innerHTML = `
    <strong>${ev.subject} - ${ev.type} (${ev.className})</strong><br>
    <em>${ev.comment}</em><br>
    <button style="margin-top:4px;font-size:10px;padding:2px 5px;" onclick="editEvent(${globalIndex})">Edytuj</button>
  `;
  cell.appendChild(evDiv);
});

        } else {
          cell.style.backgroundColor = '#eee';
          cell.style.color = '#aaa';
        }

        calendarGrid.appendChild(cell);
      }
    }
  }

  function createCell(text, isHeader = false, className = 'day') {
    const div = document.createElement('div');
    div.className = className;
    if(text !== '') div.textContent = text;
    return div;
  }

  generateCalendar(today.getMonth(), today.getFullYear());
  let editIndex = null; // globalny wskaźnik edytowanego wydarzenia

function addEvent() {
  const subject = document.getElementById('subject').value;
  const type = document.getElementById('type').value;
  const date = document.getElementById('date').value;
  const comment = document.getElementById('comment').value.trim();
  const className = document.getElementById('class').value;

  if (!date) {
    alert("Wybierz datę przed dodaniem wydarzenia.");
    return;
  }

  const events = getEvents();

  const eventData = { subject, type, date, comment, className };

  if (editIndex !== null) {
    events[editIndex] = eventData;
    editIndex = null;
  } else {
    events.push(eventData);
  }

  saveEvents(events);
  generateCalendar(+monthSelect.value, +yearSelect.value);
  document.getElementById('comment').value = '';
  document.querySelector('button').textContent = "Dodaj wydarzenie";
}

function editEvent(index) {
  const events = getEvents();
  const ev = events[index];

  document.getElementById('subject').value = ev.subject;
  document.getElementById('type').value = ev.type;
  document.getElementById('date').value = ev.date;
  document.getElementById('comment').value = ev.comment;
  document.getElementById('class').value = ev.className;

  editIndex = index;
  document.querySelector('button').textContent = "Zapisz zmiany";
}

</script>
<!-- Firebase App (core SDK) -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js"></script>
<!-- Firebase Firestore -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js"></script>
</body>
</html>
